---
steps:
  - label: "Run tests"
    command: docker-compose run --rm tests
    agents:
      queue: fma-margaret-lab
  
  - wait

  - label: "Build Docker Image"
    command: ./scripts/build.sh ${BUILDKITE_BUILD_ID}
    branches: master
    agents:
      queue: fma-margaret-lab
      
  - wait

  - label: "Push to Cloudsmith"
    command: scripts/push-image.sh
    env:
      TAG: ${BUILDKITE_BUILD_NUMBER}
    agents:
      queue: fma-margaret-lab